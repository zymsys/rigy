# Rigy — RigSpec YAML (v0.1-rc2 + Rigs roadmap note)

**Pronunciation**
- **Rigy**: “RIG-ee”
- **Ricy** (RigSpec Contract YAML): “RYE-see”
- **Rigs** (RigSpec Scene): “RIGS”

Rigy is a **text-based specification language for rigged assemblies of geometric primitives** — analogous to *Mermaid for 3D assets*.

Rigy allows authors to describe:
- geometric primitives
- skeletal armatures (bones / joints)
- deterministic skinning relationships

using a simple, human-readable YAML format. Specifications compile deterministically into standard 3D formats such as **glTF** or **FBX**, which can be loaded directly into tools like **Blender**, **Godot**, or **Motion** without custom importers.

---

## Design Principles

- **Human-readable & machine-generatable**  
  Indentation-based YAML, minimal punctuation, comments allowed everywhere.

- **Narrow scope (v0.1)**  
  Articulated assemblies of geometric primitives with skeletal control.

- **Deterministic**  
  Same spec → same structural result (topology, indexing, hierarchy).

- **Interoperable**  
  Compiles to industry-standard formats; no proprietary runtime required.

---

## Non-Goals for v0.1

Rigy v0.1 intentionally does **not** attempt to:

- Replace DCC-authored organic character rigs
- Support continuous mesh deformation within a primitive
- Define animation curves or constraints
- Provide artist-authored UV layouts or material schemas
- Guarantee bit-exact floating-point output across CPU architectures

These capabilities are deferred to future versions.

---

## Determinism Model

Determinism in Rigy v0.1 is defined at the **structural level**, not bit-identical floating-point math.

The compiler must ensure:

- Primitive tessellation is fixed per primitive type and tessellation profile.
- Vertex and index ordering are stable and documented.
- Bone creation order matches YAML order exactly.
- No randomness or implicit defaults in strict mode.

Minor floating-point variation across platforms is acceptable provided topology, hierarchy, and indexing remain identical.

---

## Coordinate System & Units

Rigy uses a canonical coordinate system aligned with **glTF 2.0**.

```yaml
units: meters
coordinate_system:
  up: Y
  forward: -Z
  handedness: right
```

- All coordinates are expressed in this reference frame.
- Bone coordinates are expressed in **armature-local space**.

---

## Versioning

```yaml
version: "0.1"
```

- `version` is **required**.
- Compilers must reject unsupported **major** versions.
- Newer **minor** versions may emit warnings but should load if compatible.
- Unknown fields must cause errors in strict mode.

---

## Meshes

A mesh defines one or more geometric primitives that are merged into a single mesh object.

### Supported Primitive Types (v0.1)

- `box`
- `sphere`
- `capsule`
- `cylinder`

Each primitive type uses a fixed tessellation defined by the active profile.

```yaml
tessellation_profile: v0_1_default
```

### Tessellation Profile: `v0_1_default`

| Primitive | Tessellation |
|---------|--------------|
| box | 6 faces, 12 triangles |
| sphere | 16 latitude × 32 longitude |
| cylinder | 32 radial × 1 height |
| capsule | cylinder (8 height) + hemispheres (8 rings) |

### Mesh Rules

- Primitive transforms are applied **before mesh merge**.
- Primitive IDs must be unique within a mesh.
- All primitive dimensions must be greater than zero.

---

## Armatures

An armature defines a tree of bones.

### Bone Semantics

- `parent: none` designates a root bone.
- `head` and `tail` are armature-local coordinates.
- `roll` is in **radians**, applied around the bone’s local Y axis.
- Bones must form an acyclic hierarchy.
- Zero-length bones are invalid.

---

## Skinning Model (v0.1)

Rigy v0.1 models **articulated assemblies of rigid or semi-rigid primitives**.

Skinning is defined **per primitive**, not per vertex.

- All vertices generated by a primitive receive identical weights.
- Weight values must be in `[0.0, 1.0]`.
- Weights are normalized per primitive prior to export.
- No implicit blending across primitives is performed.

---

## Bindings

A binding connects one mesh to one armature and assigns primitive weights.

### Binding Rules

- Each mesh may appear in **only one** binding block.
- All referenced IDs must exist.

---

## Materials (v0.1)

Materials are external symbolic references:

```yaml
material: skin
```

- Rigy v0.1 guarantees **visual sanity**, not visual fidelity.
- Compilers may generate placeholders or map names to target systems.

---

## UV Coordinates (v0.1)

Rigy v0.1 does not define UV layouts.

- Compilers may generate default UVs procedurally.
- Export targets may apply their own defaults.

---

## Identifier Stability

- `id` fields are stable identifiers and must not change once published.
- `name` fields are human-readable labels and may change freely.

---

## Symmetry (Compile-Time Sugar)

`symmetry` is optional. If present, compilers must expand it **before validation**.

- Missing `symmetry` means no expansion.
- `symmetry: {}` means no expansion.

Symmetry expansion must be deterministic, preserving outward-facing normals and consistent winding order.

---

## Validation Rules (MVP)

The compiler must fail if:

- Required fields are missing
- IDs are undefined or duplicated
- Bone hierarchies contain cycles
- Primitive dimensions are invalid
- Weight values are out of range
- Unknown fields appear in strict mode

---

## Roadmap (Non-Normative)

### v0.2 (Composition + Contracts)
- Imports (library reuse) with namespaces
- First-class anchors (mesh-space locators); bone heads MAY be treated as implicit anchors
- Instances (scene-like part assembly)
- `attach3`: 3-anchor frame attachment
- Ricy contracts for public interfaces and anchor sets

### v0.2+ (Rigs: RigSpec Scene — layout DSL)
A **separate file type** for artist-friendly composition and layout. Rigs files reference Rigy assets and arrange them
using named **slots/mounts**, plus small “human” edits like **nudge** and **rotate**.

- File type: `*.rigs.yaml`
- Rigy remains strict and asset-focused; Rigs handles layout and assembly.
- Rigs compiles to either:
  - a flattened Rigy spec (for export), or
  - directly to glTF scene assembly.

**Reserved concepts (names subject to finalization):** `imports`, `scene`, `children`, `place`, `slot`, `mount`, `nudge`, `rotate`.

### v0.3
- Region-based weighting within primitives
- Vertex-level skinning weights
- Custom mesh topology import

### v1.0
- Animation clips
- Blend shapes / deformation
- Physics and simulation hooks
